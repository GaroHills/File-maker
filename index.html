<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Image & PDF Tool</title>
    <!-- Load Libraries via CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 { margin-bottom: 20px; text-align: center; }

        .container {
            width: 100%;
            max-width: 800px;
            background: var(--card);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: #e2e8f0;
            border-bottom: 1px solid #cbd5e1;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 600;
            color: #64748b;
            transition: all 0.2s;
        }

        .tab-btn:hover { background: #cbd5e1; }
        .tab-btn.active {
            background: var(--card);
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        /* Content Sections */
        .section {
            display: none;
            padding: 25px;
        }
        .section.active { display: block; }

        /* Controls */
        .control-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 500; }
        
        input[type="file"] {
            display: block;
            width: 100%;
            padding: 10px;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            cursor: pointer;
        }

        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
        }

        button.action-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
        }

        button.action-btn:hover { opacity: 0.9; }
        button.action-btn:disabled { background-color: #94a3b8; cursor: not-allowed; }

        /* Status */
        #status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            display: none;
        }
        .status-processing { background: #dbeafe; color: #1e40af; }
        .status-success { background: #dcfce7; color: #166534; }
        .status-error { background: #fee2e2; color: #991b1b; }

        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .image-preview img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        small { color: #64748b; }
    </style>
</head>
<body>

    <h1>Media Converter Suite</h1>

    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('tab-convert')">Image Converter</button>
            <button class="tab-btn" onclick="openTab('tab-pdf-img')">PDF â†” Image</button>
            <button class="tab-btn" onclick="openTab('tab-merge')">Merge / Join</button>
            <button class="tab-btn" onclick="openTab('tab-size')">PDF Size Tools</button>
        </div>

        <!-- 1. Image Converter (JPG<->PNG etc) -->
        <div id="tab-convert" class="section active">
            <h3>Convert Image Format</h3>
            <div class="control-group">
                <label>Select Image (JPG, PNG, WebP...)</label>
                <input type="file" id="imgConvInput" accept="image/*">
            </div>
            <div class="control-group">
                <label>Convert To:</label>
                <select id="imgConvFormat">
                    <option value="image/jpeg">JPG / JPEG</option>
                    <option value="image/png">PNG</option>
                    <option value="image/webp">WebP</option>
                </select>
            </div>
            <div class="control-group" id="qualityWrapper">
                <label>Quality (0.1 - 1.0) <small>(For JPG/WebP)</small></label>
                <input type="range" id="imgConvQuality" min="0.1" max="1.0" step="0.1" value="0.9">
                <span id="qualityVal">0.9</span>
            </div>
            <button class="action-btn" onclick="convertImage()">Convert & Download</button>
        </div>

        <!-- 2. PDF <-> Image -->
        <div id="tab-pdf-img" class="section">
            <h3>Image to PDF</h3>
            <div class="control-group">
                <label>Select Images (Multiple allowed)</label>
                <input type="file" id="i2pInput" accept="image/*" multiple onchange="previewImages(this, 'i2pPreview')">
                <div id="i2pPreview" class="image-preview"></div>
            </div>
            <button class="action-btn" onclick="imagesToPdf()">Convert Images to PDF</button>

            <hr style="margin: 30px 0; border: 0; border-top: 1px solid #ddd;">

            <h3>PDF to Image</h3>
            <div class="control-group">
                <label>Select PDF</label>
                <input type="file" id="p2iInput" accept="application/pdf">
            </div>
            <div class="control-group">
                <label>Output Format</label>
                <select id="p2iFormat">
                    <option value="jpeg">JPG</option>
                    <option value="png">PNG</option>
                </select>
            </div>
            <button class="action-btn" onclick="pdfToImages()">Convert PDF to Images (ZIP)</button>
        </div>

        <!-- 3. Merge / Join -->
        <div id="tab-merge" class="section">
            <h3>Merge Images</h3>
            <p><small>Join multiple images into a single long image (Vertical).</small></p>
            <div class="control-group">
                <label>Select Images</label>
                <input type="file" id="mergeInput" accept="image/*" multiple onchange="previewImages(this, 'mergePreview')">
                <div id="mergePreview" class="image-preview"></div>
            </div>
            <button class="action-btn" onclick="mergeImages()">Merge & Download</button>
        </div>

        <!-- 4. PDF Size Tools -->
        <div id="tab-size" class="section">
            <h3>PDF Size Manipulator</h3>
            <div class="control-group">
                <label>Select PDF</label>
                <input type="file" id="sizeInput" accept="application/pdf">
            </div>
            <div class="control-group">
                <label>Operation</label>
                <select id="sizeMode">
                    <option value="compress">Decrease Size (Compress)</option>
                    <option value="increase">Increase Size (Add Padding)</option>
                </select>
            </div>
            <div class="control-group">
                <label>Intensity</label>
                <input type="range" id="sizeIntensity" min="1" max="10" value="5">
                <small>Low -> High Intensity</small>
            </div>
            <button class="action-btn" onclick="processPdfSize()">Process PDF</button>
        </div>

        <div id="status"></div>
    </div>

    <script>
        // --- Configuration & Helpers ---
        const { jsPDF } = window.jspdf;
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        function showStatus(msg, type = 'processing') {
            const el = document.getElementById('status');
            el.style.display = 'block';
            el.className = `status-${type}`;
            el.innerText = msg;
        }

        function hideStatus() {
            document.getElementById('status').style.display = 'none';
        }

        function openTab(id) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
            hideStatus();
        }

        document.getElementById('imgConvQuality').addEventListener('input', (e) => {
            document.getElementById('qualityVal').innerText = e.target.value;
        });

        // Helper: Read file as Data URL
        const readFile = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        };

        // Helper: Load image from source
        const loadImage = (src) => {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = src;
            });
        };

        function previewImages(input, divId) {
            const container = document.getElementById(divId);
            container.innerHTML = '';
            if (input.files) {
                Array.from(input.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        container.appendChild(img);
                    }
                    reader.readAsDataURL(file);
                });
            }
        }

        // --- 1. Image Converter ---
        async function convertImage() {
            const input = document.getElementById('imgConvInput');
            if (!input.files[0]) return showStatus("Please select an image first.", "error");

            showStatus("Converting...");
            
            try {
                const file = input.files[0];
                const format = document.getElementById('imgConvFormat').value;
                const quality = parseFloat(document.getElementById('imgConvQuality').value);

                const dataUrl = await readFile(file);
                const img = await loadImage(dataUrl);

                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);

                // Convert
                canvas.toBlob((blob) => {
                    if (!blob) return showStatus("Conversion failed.", "error");
                    const ext = format.split('/')[1];
                    saveAs(blob, `converted-image.${ext}`);
                    showStatus("Conversion successful! Downloading...", "success");
                }, format, quality);

            } catch (err) {
                console.error(err);
                showStatus("Error processing image.", "error");
            }
        }

        // --- 2. Images to PDF ---
        async function imagesToPdf() {
            const input = document.getElementById('i2pInput');
            if (input.files.length === 0) return showStatus("Select at least one image.", "error");

            showStatus("Generating PDF...");
            try {
                const doc = new jsPDF();
                
                for (let i = 0; i < input.files.length; i++) {
                    const dataUrl = await readFile(input.files[i]);
                    const img = await loadImage(dataUrl);
                    
                    const imgProps = doc.getImageProperties(img);
                    const pdfWidth = doc.internal.pageSize.getWidth();
                    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                    if (i > 0) doc.addPage();
                    doc.addImage(img, 'JPEG', 0, 0, pdfWidth, pdfHeight);
                }

                doc.save("images-combined.pdf");
                showStatus("PDF Generated!", "success");
            } catch (err) {
                console.error(err);
                showStatus("Error creating PDF.", "error");
            }
        }

        // --- 3. PDF to Images ---
        async function pdfToImages() {
            const input = document.getElementById('p2iInput');
            if (!input.files[0]) return showStatus("Select a PDF file.", "error");

            showStatus("Reading PDF pages... (This may take a while)", "processing");
            
            try {
                const fileData = await readFile(input.files[0]);
                const pdf = await pdfjsLib.getDocument(fileData).promise;
                const zip = new JSZip();
                const format = document.getElementById('p2iFormat').value; // png or jpeg

                for (let i = 1; i <= pdf.numPages; i++) {
                    showStatus(`Processing page ${i} of ${pdf.numPages}...`);
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({ scale: 2.0 }); // High res
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    await page.render({ canvasContext: context, viewport: viewport }).promise;
                    
                    const imgData = canvas.toDataURL(`image/${format}`).split(',')[1];
                    zip.file(`page-${i}.${format}`, imgData, {base64: true});
                }

                showStatus("Zipping files...");
                const content = await zip.generateAsync({type:"blob"});
                saveAs(content, "pdf-images.zip");
                showStatus("Complete! Downloading ZIP.", "success");

            } catch (err) {
                console.error(err);
                showStatus("Error converting PDF.", "error");
            }
        }

        // --- 4. Merge Images (Join Marge) ---
        async function mergeImages() {
            const input = document.getElementById('mergeInput');
            if (input.files.length < 2) return showStatus("Select at least 2 images to merge.", "error");

            showStatus("Merging images...");
            try {
                const images = [];
                let totalHeight = 0;
                let maxWidth = 0;

                // Load all images first to calculate dimensions
                for (let file of input.files) {
                    const d = await readFile(file);
                    const img = await loadImage(d);
                    images.push(img);
                    totalHeight += img.height;
                    maxWidth = Math.max(maxWidth, img.width);
                }

                const canvas = document.createElement('canvas');
                canvas.width = maxWidth;
                canvas.height = totalHeight;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = "#FFFFFF"; // Background
                ctx.fillRect(0,0, maxWidth, totalHeight);

                let currentY = 0;
                images.forEach(img => {
                    // Center image if smaller than max width, or stretch? Let's keep original scale left aligned
                    ctx.drawImage(img, 0, currentY);
                    currentY += img.height;
                });

                canvas.toBlob(blob => {
                    saveAs(blob, "merged-image.png");
                    showStatus("Images merged successfully!", "success");
                });

            } catch(err) {
                console.error(err);
                showStatus("Error merging images.", "error");
            }
        }

        // --- 5. PDF Size Manipulator ---
        async function processPdfSize() {
            const input = document.getElementById('sizeInput');
            const mode = document.getElementById('sizeMode').value;
            const intensity = parseInt(document.getElementById('sizeIntensity').value);
            
            if (!input.files[0]) return showStatus("Select a PDF file.", "error");

            showStatus("Processing PDF... Please wait.");

            try {
                const fileData = await readFile(input.files[0]);
                const pdf = await pdfjsLib.getDocument(fileData).promise;
                const newPdf = new jsPDF();
                
                // Common Loop: Render page to canvas -> Add to new PDF
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    // Compress Mode: Low scale. Increase Mode: High scale
                    const scale = mode === 'compress' ? Math.max(0.5, 1 - (intensity/10)) : 1.5; 
                    
                    const viewport = page.getViewport({ scale: scale });
                    const canvas = document.createElement('canvas');
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;
                    const ctx = canvas.getContext('2d');

                    await page.render({ canvasContext: ctx, viewport: viewport }).promise;

                    if (i > 1) newPdf.addPage();

                    const pdfW = newPdf.internal.pageSize.getWidth();
                    const pdfH = newPdf.internal.pageSize.getHeight();

                    // Compression logic: Use low quality JPEG
                    const quality = mode === 'compress' ? (1 - (intensity/11)) : 1.0; 
                    
                    // Add the visual content
                    const imgData = canvas.toDataURL('image/jpeg', quality);
                    newPdf.addImage(imgData, 'JPEG', 0, 0, pdfW, pdfH);

                    // Increase Size Logic: Add invisible high-res garbage data
                    if (mode === 'increase') {
                        // We add invisible text or hidden images repeatedly based on intensity
                        newPdf.setFontSize(1);
                        newPdf.setTextColor(255, 255, 255); // White text
                        const garbageString = "01010101".repeat(500 * intensity); // Dummy data
                        for(let k=0; k<intensity*2; k++) {
                            newPdf.text(garbageString, 0, k);
                        }
                    }
                }

                const fileName = mode === 'compress' ? 'compressed.pdf' : 'increased.pdf';
                newPdf.save(fileName);
                showStatus("Processing Complete!", "success");

            } catch (err) {
                console.error(err);
                showStatus("Error processing PDF. File might be too large/complex.", "error");
            }
        }

    </script>
</body>
</html>
